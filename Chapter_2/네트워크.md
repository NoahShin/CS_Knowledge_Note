# 네트워크

# 네트워크의 기초

- 네트워크란 노드와 링크가 서로 연결되어 있거나 열결되어 있지 않은 집합체를 의미
 
- 여기서 노드란 서버, 라우터, 스위치등 네트워크 장치를 의미하고 링크는 유선 또는 무선을 의미

## 처리량과 지연 시간

- 좋은 네트워크란 많을 처리량을 처리할수 있으며 지연시간(latency)이 짧고 장애 빈도가 적으며
좋은 보안을 갖춘 네트워크

### 처리량:
- throughput(처리량) 이란 링크를 통해 전달되는 단위 시간당 데이터양을 말함

- 단위로는 bps (bits per second) 초당 전송/수신 되는 비트 수

- 처리량은 사용자들이 많이 접속할 때마다 커지는 트래픽, 네트워크 장치 간의 대역폭, 네트워크 중간에 발생하는 에러, 장치의 하드웨어 스펙에 영향을 받음.

⚠️ 대역폭: 주어진 시간동안 네트워크 연결을 통해 흐를 수 있는 최대 비트 수

### 지연 시간
- latency 란 요청이 처리되는 시간을 말하며 어떤 메시지가 두 장치 사이를 왕복하는데 걸린 시간

내컴에서 서버까지 요청하는 시간 800ms 
서버에서 내컴까지 응답하는 시간 900ms
총 1.7s 

- 지연시간은 매체 타입(무선,유선), 패킷 크기, 라우터의 패킷 처리 시간에 영향을 받습니다.

## 네트워크 토폴로지와 병목 현상

Network Topology는 노드와 링크가 어떻게 배치되어 있는지에 대한 방식이자 연결 행태를 의미

이런게 있구나 ~ 라는 생각으로 넘어 갑시다.

- 트리 토폴로지 
![](https://velog.velcdn.com/images/noahshin__11/post/e2579fe6-abde-4ce1-b3f3-5fbfee35a59c/image.png)
노드의 추가, 삭제가 쉬우며 특정 노드에 트래픽이 집중될 때 하위 노드에 영향을 끼칠 수 있다.
- 버스 토폴로지
![](https://velog.velcdn.com/images/noahshin__11/post/3071162a-4e6b-42aa-b9c5-6ca8e8d00397/image.png)
중앙 통신 회선 하나에 여러개의 노드가 연결되어 공유하는 네트워크 구성
근거리 통신망(LAN)에서 사용
설치 비용이 적고 신뢰성이 우수, 
중앙 통신 회선에 노드를 추가하거나 삭제하기 쉽다.
단점: 스푸핑이 가능함
⚠️ 스푸핑: LAN상에서 송신부의 패킷을 송신과 관련 없는 다른 호스트에 가지 않도록 하는 스위칭 기능을 마비시키거나 속여서 특정 노드에 해당 패킷이 오도록 처리하는 것

- 스타 토폴로지
![](https://velog.velcdn.com/images/noahshin__11/post/aec8cb66-2f61-495c-bd37-d7beec4f5c7f/image.png)
중앙에 있는 노드에 모두 연결된 네트워크 구성
노드를 추가하거나 에러 탐지 쉽고,  패킷의 충돌 발생 가능성 적다.

- 링형 토폴로지
![](https://velog.velcdn.com/images/noahshin__11/post/f2729ec4-430b-48dd-b4ca-bc0efc597e2d/image.png)
노드 수가 증가되어도 네트워크상의 손실이 거의 없고 충돌이 발생되는 가능성이 적고 노드의 고장 발견을 쉽게 찾을 수 있다.
하지만 네트워크 구성 변경이 어렵고 회선에 장애가 발생하면 전체 네트워크에 영향을 크게 끼침

- 메시 토폴로지
![](https://velog.velcdn.com/images/noahshin__11/post/487ddd3a-c32b-4531-986b-3680add594c8/image.png)
그물망
한 단말 장치에 장애 발생해도 네트워크 계속 사용 가능, 트래픽 분산처리 가능
하지만 노드의 추가 어렵
구축 비용과 운용비용이 고가

### 병목 현상

자 왜 토폴로지 알아봤냐면,
중요한 이유는 병목 현상을 탖을 때 중요한 기준이 되기 때문

예를들어
어떤 서비스를 만들었는데, 
병목현상이 일어나서, 서비스의 지연 시간이 길어지고 있다.

그래서 관리자가 대역폭을 크게 설정했음에도 성능이 개선되지 않았지만,
토폴로지 확인하고, 서버와 서버 간 그리고 게이트웨이로 이어지는 회선을 추가해서 병목현상을 해결
(개멋있는데 실제로 어떻게 하는지 누가 설명좀...)

### 네트워크 분류

- 네트워크는 규모를 기반으로 분류 가능

- LAN (Local Area Network)
- MAN (Metropolitan Area Network)
- WAN (Wide Area Network)

> LAN 은 근거리 통신망을 의미하며 건물이나 캠퍼스 같은 좁은 공간에서 운영
전송 속도가 빠르고 혼잡하지 않다.

> MAN 은 대도시 지역 네트워크를 나타내며 도시 같은 넓은 지역에서 운영

> WAN 광역 네트워크를 의미하며 국가 또는 대륙 같은 더 넓은 지역에서 운영된다.

(커질수록 전송속도는 낮으면서 더 혼잡해진다.)

### 네트워크 성능 분석 명령어

애플리케이션 코드상에선 문제가 없는데 사용자가 서비스로부터 데이터를 가져오지 못하는 상황이 발생하기도 한다.
보통 이럴때 병목 현상일 가능성이 있다. (응 항상 내코드 잘못이였어 ~ )
병목현상의 주된 원인
- 네트워크 대역폭
- 네트워크 토폴로지
- 서버 CPU, 메모리 사용량
- 비효율적인 네트워크 구성

### ping (Packet INternet Groper)
핑이 약자인지 알았던 사람...? 🤷🏼‍♂️
핑은 네트워크 상태를 확인하려는 대상 노드를 향해 일정 크기의 패킷을 전송하는 명령어 입니다.

이를 통해 해당 노드의 패킷 수신 상태와 도달하기까지 시간 등을 알 수 있으며 해당 노드까지 네트워크가 잘 연결되어 있는지 확인할 수 있따.
- ping은 TCP/IP 프로토콜중에 ICMP 프로토콜을 통해 동작하며, 이 때문에 ICMP 프로토콜을 지원하지 않는 기기를 대상으로는 실행할 수 없거나 네트워크 정책상 ICMP 나 traceroute를 차단하는 대상의 경우 ping 테스팅은 불가능합니다.

ping [ip 주소 또는 도메인 주소]로 실행한다. 

![](https://velog.velcdn.com/images/noahshin__11/post/88819192-4774-4000-bdf6-f9bb4e0db114/image.png)

-n 7 옵션을 넣어서 7번의 패킷을 보내고 7번의 패킷을 받는 모습을 볼수 있다.

### netstat
netstat 명령어는 접속되어 있는 서비스들의 네트워크 상태를 표시하는 데 사용되며 네트워크 접속, 라우팅 테이블, 네트워크 프로토콜 등 리스트를 보여준다.
- 주로 서비스의 포트가 열려 있는지 확인할 때 씀
![](https://velog.velcdn.com/images/noahshin__11/post/a7b84cb1-48fc-4ca9-b144-e8e7926ee587/image.png)

### nslookup
nslookup 은 DNS에 관련된 내용을 확인하기 위해 쓰는 명령어,
특정 도메인에 매핑된 IP를 확인하기 위해 사용

### traceroute
목적지 노드까지 네트워크 경로를 확인할 때 사용하는 명령어.
목적지 노드까지 구간들중 어느 구간에서 응답시간이 느려지는지 등을 확인할 수 있다.

## 네트워크 프로토콜 표준화

TCP/IP 4계층 모델
![](https://velog.velcdn.com/images/noahshin__11/post/e9af6776-f172-46e1-a8ee-ed7aba025096/image.png)


![](https://velog.velcdn.com/images/noahshin__11/post/b5f1775e-79ef-46d1-8794-e8e63ae58e5f/image.png)


![](https://velog.velcdn.com/images/noahshin__11/post/23519302-6db5-4f89-846b-3d7c4292a2f8/image.png)


![](https://velog.velcdn.com/images/noahshin__11/post/b2718393-db7f-4680-9aeb-c2f0add55ca6/image.png)


### 전송 계층

전송(Transport) 계층은 송신자와 수신자를 연결하는 통신 서비스를 제공하며 연결 지향 데이터 스트림 지원, 신뢰성, 흐름제어를 제공하며, 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 때의 중계 역할, 
예로는 TCP, UDP 
TCP 는 패킷사이의 순서를 보장하고 연결지향 프로토콜을 사용
신뢰성 구축해서 수신 여부 확인하며 "가상회선 패킨 교환 방식"을 사용

UDP는 순서를 보장하지 않고 수신 여부를 확인하지 않고 단순히 데이터만 주는 "데이터그램 패킷 교환방식"


### 가상회선 패킨 교환 방식
![](https://velog.velcdn.com/images/noahshin__11/post/937e6578-67cc-4c3d-a710-588ba76da7d4/image.png)


### 데이터그램 패킷 교환방식

패킷이 독립적으로 이동하며 최적의 경로를 선택하여 가는데,
도착한 "순서가 다를 수" 있는 방식
![](https://velog.velcdn.com/images/noahshin__11/post/ee1f578d-6a56-4e92-8014-c9eb764327c0/image.png)


### TCP 연결 성립 과정
TCP는 신뢰성을 확보할때 "3-웨이 핸드쉐이크" 라는 작업을 진행
![](https://velog.velcdn.com/images/noahshin__11/post/974a8de0-0abe-4beb-aa01-9e6243d7cfd6/image.png)

![](https://velog.velcdn.com/images/noahshin__11/post/996af5f9-2c37-490a-b290-1847702c3d71/image.png)

이런 3웨이 핸드쉐이크 과정 이후 신뢰성이 구축되고 데이터 전송을 시작,

참고로 TCP 는 이 과정이 있기 때문에 신뢰성이 있는 계층이라고 하며 UDP 는 이 과정이 없어서 신뢰성이 없는 계층

> SYN: Synchronization 의 약자, 연결 요청 플래그
ACK: acknowledgement 의 약자, 응답 플래그
ISN: Initial Sequence Numbers 의 약어, 초기 네트워크 연결을 할 때 할당된 32비트 고유 시쿼스 번호

### TCP 연결 해제 과정
4-웨이 핸드쉐이크
![](https://velog.velcdn.com/images/noahshin__11/post/ec9b5137-f508-4f3a-b54e-96093dabe68f/image.png)

이 과정중에 중요한건 **TIME_WAIT** 
그냥 연결을 닫으면 되지 왜 굳이 일정시간 뒤에 닫을까?

1. 지연 패킷이 발생할 경우를 대비하기 위함.
패킷이 뒤늦게 도달하고 이를 처리하지 못한다면 데이터 무결성 문제가 발생
2. 두 장치가 연결이 닫혔는지 확인하기 위해서.
만약 LAST_ACK 상태에서 닫히게 되면 다시 새로운 연결을 하려고 할 때 장치는 줄곧 LAST_ACK 로 되어 있기 때문에 접속 오류가 나타남.
이래서 TIME_WAIT 필요

![](https://velog.velcdn.com/images/noahshin__11/post/7bf77e95-0966-421a-bfc0-00122c1bd895/image.png)

## 인터넷 계층
- 장치로부터 받은 네트워크 패킷을 IP주소로 지정된 목적지로 전송하기 위해 사용되는 계층. 
IP, ARP, ICMP 등이 있으며 패킷을 수신해야 할 상대의 주소를 지정하여 데이터를 전달.
상대방이 제대로 받았는지에 대해 보장하지 않는 비연결형적인 특징.

## 링크 계층
- 전선, 광섬유, 무선 등으로 실질적으로 데이터를 전달하며 장치간에 신호를 주고받는 "규칙"을 정하는 계층.
- 네트워크 접근 계층이라고도 한다.

- 이를 물리 계층과 데이터 링크 계층으로 나누기도 하는데
물리 계층은 무선 LAN 과 유선 LAN 을 통해 0 & 1 로 이루어진 데이터를 보내는 계층을 말한다.
- 데이터 링크 계층은 '이더넷 프레임'을 통해 에러확인, 흐름제어, 접근제어를 담당하는 계층

### 유선 LAN (IEEE802.3)
### _전이중화 통신_
- (full duplex) 통신은 양쪽 장치가 동시에 송수신할 수 있는 방식
송신로와 수신로로 나눠서 데이터를 주고받고 
- 현대의 고속 이더넷은 이 방식을 기반으로 통신
![](https://velog.velcdn.com/images/noahshin__11/post/c2583090-264a-43c3-b0e6-513604600189/image.png)

### 유선 LAN 을 이루는 케이블
TP 케이블이라고 하는 트위스트 페어 케이블과 광섬유 케이블이 대표적

> 트위스트 페어 케이블: 하나의 케이블처럼 보이지만 실제로는 8개의 구리선을 두개씩 꼬아서 묶은 케이블
![](https://velog.velcdn.com/images/noahshin__11/post/44123ce3-d914-4f0d-8ad4-cf9ffec46d5d/image.png)
8개의 구리선

케이블은 구리선을 실드 처리하지 않고 덮은 UTP 케이블과 실드 처리하고 덮은 STP로 나눠진다.
우리가 흔히 볼 수 있는 케이블은 UTP 케이블로 흔히 LAN 케이블이라고 한다.

![](https://velog.velcdn.com/images/noahshin__11/post/a63c5e3c-d726-4ac2-b79a-7c550f5fd075/image.png)

### 광섬유 케이블
- 레이저를 이용해서 통신하기 때문에 구리선과는 비교할 수 없을 만큼 장거리 및 고속 통신 가능,
- 보통 100Gbps 의 데이터를 전송하며 다음 그림처럼 광섬유 내부와 외부를 다른 밀도를 가지는 유리나 프랄스틱 섬유로 제작해서 한 번 들어간 빛이 내부에서 계속적으로 반사하며 전진하여 반대편 끝까지 가는 원리를 이용한 것
![](https://velog.velcdn.com/images/noahshin__11/post/a58a6a9b-be3b-4d28-b1cf-0a7462bb234d/image.png)

### 무선 LAN (IEEE802.11) 반이중화 통신
- half duplex 는 양쪽 장치는 서로 통신할 수 있지만, 동시에는 통신할 수 없으며 한번에 한 방향만 통신할 수 있는 방식
![](https://velog.velcdn.com/images/noahshin__11/post/5c16ddfe-c601-4eeb-aa93-352d1fec186a/image.png)

일반적으로 장치가 신호를 수신하기 시작하면 응답하기 전에 전송이 완료될 때까지 기다려야한다.

고로 충돌방지 시스템필요 ! 

### CSMA/CA
- 반이중화 통신 중 하나로 장치에서 데이터를 보내기 전에 캐리어 감지 등으로 사전에 가능한 한 충돌을 방지하는 방식을 사용
![](https://velog.velcdn.com/images/noahshin__11/post/71309134-8eba-4a57-9bc7-934289f94bcf/image.png)

#### 무선 LAN 을 이루는 주파수
WLAN (wireless LAN)
- 비유도 매체인 공기에 주파수를 쏘아 무선 통신망을 구축하는데, 주파수 대역은 2.4GHz 대역 또는 5GHz 대역 중 하나를 써서 구축한다.
- 2.4GHz는 장애물에 강하지만 전자렌지, 무선등 전파 간섭이 일어나는 경우가 많고
- 5GHz 대역은 사용할 수 있는 채널 수도 많고 동시에 사용할 수 있고, 상대적으로 깨끗한 전파 환경을 구축,
결론: 5GHz 써라~ 

### 와이파이
- 전자기기들이 무선 LAN 신호에 연결할 수 있게 하는 기술
- 이를 사용하려면 무선 접속 장치 (AP, Access Point) 가 있어야한다. 
- 흔히 이를 공유기라고 하며, 
- 이를 통해 유선 LAN 에 흐르는 신호를 무선 LAN 신호로 바꿔주어 신호가 닿는 범위 내에서 무선 인터넷을 사용할 수 있게 된다.
- 참고로 무선 LAN을 이용한 기술로는 와이파이만 있는 것이 아니고 지그비, 블루투스등이 있다.

### BSS 
Basic Service Set은 기본 서비스 집합을 의미
- 단순 공유기를 통해 네트워크에 접속하는 것이 아닌 동일 BSS 내에 있는 AP 들과 장치들이 서로 통신 가능한 구조를 말함
- 근거리 무선 통신을 제공하고, 하나의 AP 만을 기반으로 구축이 되어 있어 사용가가 한 곳에서 다른 곳으로 자유롭게 이동하며 네트워크에 접속하는것은 불가능

### ESS 
Extended Service Set은 하나 이상의 연결된 BSS 그룹
- 장거리 무선 통신을 제공하며 BSS 보다 더 많은 가용성과 이동성을 지원,
- 즉, 사용자는 한 장소에서 다른 장소로 이동하며 중단없이 네트워크에 계속 연결할 수 있다.
![](https://velog.velcdn.com/images/noahshin__11/post/35ff57a2-506a-4901-8b4c-baa43a6c12b7/image.png)

이건,, 모르겠어서 복붙
![](https://velog.velcdn.com/images/noahshin__11/post/6868e817-742d-48a0-8310-47a66d18f2ff/image.png)

## 계층 간 데이터 송수신 과정
내가 컴퓨터를 통해 다른 컴퓨터로 요청한다면 어떤일이 일어날까?
![](https://velog.velcdn.com/images/noahshin__11/post/b5995351-4621-44ad-9d9f-2dc198c562d7/image.png)

애플리케이션 계층에서 전송 계층으로 필자가 보내는 요청(request) 값들이 캡슐화 과정을 거쳐 전달되고, 다시 링크 계층을 통해 해당 서버와 통신을 하고, 해당 서버의 링크 계층으로부터 애플리케이션까지 비캡슐화 과정을 거쳐 데이터가 전송된다.

### 캡슐화 과정
- 캡슐화 과정은 상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함시키고 해당 계층의 헤더를 삽입하는 과정
- 애플리케이션 계층의 데이터가 전송 계층으로 전달되면서 '세그먼트' 또는 '데이터그램'화 되며
TCP(L4) 헤더가 붙여지게 된다.
- 그리고 이후 인터넷 계층으로 가면서 IP(L3) 헤더가 붙여지게 되며 "패킷"화가 되고, 이후
링크 계층으로 전달되면서 프레임 헤더와 프레임 트레일러가 붙어 "프레임"화가 된다.
![](https://velog.velcdn.com/images/noahshin__11/post/8904f631-40a6-48f9-951a-4f37576d0989/image.png)

### 비 캡슐화 과정
다시 반대로 가서 그 이후 최종적으로 사용자에게 애플리케이션의 PDU인 메세지로 전달된다.
![](https://velog.velcdn.com/images/noahshin__11/post/8f1a8ea0-31d9-45de-a490-3aebff0eb856/image.png)


## PDU
- 네트워크의 어떠한 계층에서 계층으로 데이터가 전달될 때 한 덩어리의 단위를 PDU 라고한다
(Protocol Data Unit)
- PDU는 제어 관련 정보들이 포함된 "헤더", 데이터를 의미하는 '페이로드'로 구성되어있으며 계층마다 부르는 명칭이 다르다.
![](https://velog.velcdn.com/images/noahshin__11/post/73837056-4761-4b87-a075-71c74cbb8ae1/image.png)

> 참고로 PDU 중 아래 계층인 비트로 송수신하는 것이 모든 PDU 중 가장 빠르고 효율성이 높다. 
하지만 애플리케이션 계층에서는 문자열을 기반으로 송수신을 하는데, 그 이유는 헤더에 authorization 값 등 다른 값들을 넣는 확장이 쉽기 때문

# 네트워크 기기

## 네트워크 기기의 처리 범위

- 네트워크 기기는 계층별로 처리 범위를 나눌 수 있다.
- 상위 계층의 기기는 하위 계층을 처리할 수 있지만 그 반대는 불가능.
![](https://velog.velcdn.com/images/noahshin__11/post/0de8fbcf-f187-4970-8db1-52a59caaeb82/image.png)

## 애플리케이션 계층을 처리하는 기기
#### L7 스위치
- 스위치는 여러 장비를 연결하고 데이터 통신을 중재하며 목적지가 연결된 포트로만 전기 신호를 보내 데이터를 전송하는 통신 네트워크 장비
![](https://velog.velcdn.com/images/noahshin__11/post/71e2d60d-23ac-4d69-9140-d4c3c121800c/image.png)
- L7 스위치는 로드밸런서라고도 한다 (서버의 부하를 분산)
- 클라이언트로부터 오는 요청들을 뒤쪽의 여러 서버로 나누는 역할을 하며 시스템이 처리할 수 있는 트래픽 증가를 목표로한다.
- URL, 서버, 캐시, 쿠키들을 기반으로 트래픽 분산.
- 바이러스, 불필요한 외부 데이터등을 걸러내는 필터링 기능
- 응용프로그램 수준의 트래픽 모니터링도 가능
- 정기적으로 health check 를 이용하여 감시하면서 이루어짐

### L4 스위치 L7 스위치 차이
L4 스위치도 로브밸런서라고 불리는데
- L4 스위치는 인터넷 계층을 처리하는 기기로 스트리밍 관련 서비스에서는 사용할 수 없으며 메시지를 기반으로 인식못하고 IP 와 포트를 기반으로 (특히 포트) 트래픽을 분산.
> AWS에서 L7 스위치를 이용한 LB는 ALB 컴포넌트,
L4 스위치를 이용한 LB는 NLB 컴포넌트로 한다.

### 헬스 체크
예를들어 TCP 요청을 보냈는데 3way handshake가 정상적으로 일어나지 않았다면 정상이 아닌것
![](https://velog.velcdn.com/images/noahshin__11/post/084efebe-359f-4d81-a15b-a4f1813f9b6e/image.png)
아는거니까 복붙


## 인터넷 계층을 처리하는 기기
- L3


















