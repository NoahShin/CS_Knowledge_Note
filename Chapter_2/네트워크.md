# 네트워크

# 네트워크의 기초

- 네트워크란 노드와 링크가 서로 연결되어 있거나 열결되어 있지 않은 집합체를 의미
 
- 여기서 노드란 서버, 라우터, 스위치등 네트워크 장치를 의미하고 링크는 유선 또는 무선을 의미

## 처리량과 지연 시간

- 좋은 네트워크란 많을 처리량을 처리할수 있으며 지연시간(latency)이 짧고 장애 빈도가 적으며
좋은 보안을 갖춘 네트워크

### 처리량:
- throughput(처리량) 이란 링크를 통해 전달되는 단위 시간당 데이터양을 말함

- 단위로는 bps (bits per second) 초당 전송/수신 되는 비트 수

- 처리량은 사용자들이 많이 접속할 때마다 커지는 트래픽, 네트워크 장치 간의 대역폭, 네트워크 중간에 발생하는 에러, 장치의 하드웨어 스펙에 영향을 받음.

⚠️ 대역폭: 주어진 시간동안 네트워크 연결을 통해 흐를 수 있는 최대 비트 수

### 지연 시간
- latency 란 요청이 처리되는 시간을 말하며 어떤 메시지가 두 장치 사이를 왕복하는데 걸린 시간

내컴에서 서버까지 요청하는 시간 800ms 
서버에서 내컴까지 응답하는 시간 900ms
총 1.7s 

- 지연시간은 매체 타입(무선,유선), 패킷 크기, 라우터의 패킷 처리 시간에 영향을 받습니다.

## 네트워크 토폴로지와 병목 현상

Network Topology는 노드와 링크가 어떻게 배치되어 있는지에 대한 방식이자 연결 행태를 의미

이런게 있구나 ~ 라는 생각으로 넘어 갑시다.

- 트리 토폴로지 
![](https://velog.velcdn.com/images/noahshin__11/post/e2579fe6-abde-4ce1-b3f3-5fbfee35a59c/image.png)
노드의 추가, 삭제가 쉬우며 특정 노드에 트래픽이 집중될 때 하위 노드에 영향을 끼칠 수 있다.
- 버스 토폴로지
![](https://velog.velcdn.com/images/noahshin__11/post/3071162a-4e6b-42aa-b9c5-6ca8e8d00397/image.png)
중앙 통신 회선 하나에 여러개의 노드가 연결되어 공유하는 네트워크 구성
근거리 통신망(LAN)에서 사용
설치 비용이 적고 신뢰성이 우수, 
중앙 통신 회선에 노드를 추가하거나 삭제하기 쉽다.
단점: 스푸핑이 가능함
⚠️ 스푸핑: LAN상에서 송신부의 패킷을 송신과 관련 없는 다른 호스트에 가지 않도록 하는 스위칭 기능을 마비시키거나 속여서 특정 노드에 해당 패킷이 오도록 처리하는 것

- 스타 토폴로지
![](https://velog.velcdn.com/images/noahshin__11/post/aec8cb66-2f61-495c-bd37-d7beec4f5c7f/image.png)
중앙에 있는 노드에 모두 연결된 네트워크 구성
노드를 추가하거나 에러 탐지 쉽고,  패킷의 충돌 발생 가능성 적다.

- 링형 토폴로지
![](https://velog.velcdn.com/images/noahshin__11/post/f2729ec4-430b-48dd-b4ca-bc0efc597e2d/image.png)
노드 수가 증가되어도 네트워크상의 손실이 거의 없고 충돌이 발생되는 가능성이 적고 노드의 고장 발견을 쉽게 찾을 수 있다.
하지만 네트워크 구성 변경이 어렵고 회선에 장애가 발생하면 전체 네트워크에 영향을 크게 끼침

- 메시 토폴로지
![](https://velog.velcdn.com/images/noahshin__11/post/487ddd3a-c32b-4531-986b-3680add594c8/image.png)
그물망
한 단말 장치에 장애 발생해도 네트워크 계속 사용 가능, 트래픽 분산처리 가능
하지만 노드의 추가 어렵
구축 비용과 운용비용이 고가

### 병목 현상

자 왜 토폴로지 알아봤냐면,
중요한 이유는 병목 현상을 탖을 때 중요한 기준이 되기 때문

예를들어
어떤 서비스를 만들었는데, 
병목현상이 일어나서, 서비스의 지연 시간이 길어지고 있다.

그래서 관리자가 대역폭을 크게 설정했음에도 성능이 개선되지 않았지만,
토폴로지 확인하고, 서버와 서버 간 그리고 게이트웨이로 이어지는 회선을 추가해서 병목현상을 해결
(개멋있는데 실제로 어떻게 하는지 누가 설명좀...)

### 네트워크 분류

- 네트워크는 규모를 기반으로 분류 가능

- LAN (Local Area Network)
- MAN (Metropolitan Area Network)
- WAN (Wide Area Network)

> LAN 은 근거리 통신망을 의미하며 건물이나 캠퍼스 같은 좁은 공간에서 운영
전송 속도가 빠르고 혼잡하지 않다.

> MAN 은 대도시 지역 네트워크를 나타내며 도시 같은 넓은 지역에서 운영

> WAN 광역 네트워크를 의미하며 국가 또는 대륙 같은 더 넓은 지역에서 운영된다.

(커질수록 전송속도는 낮으면서 더 혼잡해진다.)

### 네트워크 성능 분석 명령어

애플리케이션 코드상에선 문제가 없는데 사용자가 서비스로부터 데이터를 가져오지 못하는 상황이 발생하기도 한다.
보통 이럴때 병목 현상일 가능성이 있다. (응 항상 내코드 잘못이였어 ~ )
병목현상의 주된 원인
- 네트워크 대역폭
- 네트워크 토폴로지
- 서버 CPU, 메모리 사용량
- 비효율적인 네트워크 구성

### ping (Packet INternet Groper)
핑이 약자인지 알았던 사람...? 🤷🏼‍♂️
핑은 네트워크 상태를 확인하려는 대상 노드를 향해 일정 크기의 패킷을 전송하는 명령어 입니다.

이를 통해 해당 노드의 패킷 수신 상태와 도달하기까지 시간 등을 알 수 있으며 해당 노드까지 네트워크가 잘 연결되어 있는지 확인할 수 있따.
- ping은 TCP/IP 프로토콜중에 ICMP 프로토콜을 통해 동작하며, 이 때문에 ICMP 프로토콜을 지원하지 않는 기기를 대상으로는 실행할 수 없거나 네트워크 정책상 ICMP 나 traceroute를 차단하는 대상의 경우 ping 테스팅은 불가능합니다.

ping [ip 주소 또는 도메인 주소]로 실행한다. 

![](https://velog.velcdn.com/images/noahshin__11/post/88819192-4774-4000-bdf6-f9bb4e0db114/image.png)

-n 7 옵션을 넣어서 7번의 패킷을 보내고 7번의 패킷을 받는 모습을 볼수 있다.

### netstat
netstat 명령어는 접속되어 있는 서비스들의 네트워크 상태를 표시하는 데 사용되며 네트워크 접속, 라우팅 테이블, 네트워크 프로토콜 등 리스트를 보여준다.
- 주로 서비스의 포트가 열려 있는지 확인할 때 씀
![](https://velog.velcdn.com/images/noahshin__11/post/a7b84cb1-48fc-4ca9-b144-e8e7926ee587/image.png)

### nslookup
nslookup 은 DNS에 관련된 내용을 확인하기 위해 쓰는 명령어,
특정 도메인에 매핑된 IP를 확인하기 위해 사용

### traceroute
목적지 노드까지 네트워크 경로를 확인할 때 사용하는 명령어.
목적지 노드까지 구간들중 어느 구간에서 응답시간이 느려지는지 등을 확인할 수 있다.

## 네트워크 프로토콜 표준화

TCP/IP 4계층 모델
![](https://velog.velcdn.com/images/noahshin__11/post/e9af6776-f172-46e1-a8ee-ed7aba025096/image.png)


![](https://velog.velcdn.com/images/noahshin__11/post/b5f1775e-79ef-46d1-8794-e8e63ae58e5f/image.png)


![](https://velog.velcdn.com/images/noahshin__11/post/23519302-6db5-4f89-846b-3d7c4292a2f8/image.png)


![](https://velog.velcdn.com/images/noahshin__11/post/b2718393-db7f-4680-9aeb-c2f0add55ca6/image.png)


### 전송 계층

전송(Transport) 계층은 송신자와 수신자를 연결하는 통신 서비스를 제공하며 연결 지향 데이터 스트림 지원, 신뢰성, 흐름제어를 제공하며, 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 때의 중계 역할, 
예로는 TCP, UDP 
TCP 는 패킷사이의 순서를 보장하고 연결지향 프로토콜을 사용
신뢰성 구축해서 수신 여부 확인하며 "가상회선 패킨 교환 방식"을 사용

UDP는 순서를 보장하지 않고 수신 여부를 확인하지 않고 단순히 데이터만 주는 "데이터그램 패킷 교환방식"


### 가상회선 패킨 교환 방식
![](https://velog.velcdn.com/images/noahshin__11/post/937e6578-67cc-4c3d-a710-588ba76da7d4/image.png)


### 데이터그램 패킷 교환방식

패킷이 독립적으로 이동하며 최적의 경로를 선택하여 가는데,
도착한 "순서가 다를 수" 있는 방식
![](https://velog.velcdn.com/images/noahshin__11/post/ee1f578d-6a56-4e92-8014-c9eb764327c0/image.png)


### TCP 연결 성립 과정
TCP는 신뢰성을 확보할때 "3-웨이 핸드쉐이크" 라는 작업을 진행
![](https://velog.velcdn.com/images/noahshin__11/post/974a8de0-0abe-4beb-aa01-9e6243d7cfd6/image.png)

![](https://velog.velcdn.com/images/noahshin__11/post/996af5f9-2c37-490a-b290-1847702c3d71/image.png)

이런 3웨이 핸드쉐이크 과정 이후 신뢰성이 구축되고 데이터 전송을 시작,

참고로 TCP 는 이 과정이 있기 때문에 신뢰성이 있는 계층이라고 하며 UDP 는 이 과정이 없어서 신뢰성이 없는 계층

> SYN: Synchronization 의 약자, 연결 요청 플래그
ACK: acknowledgement 의 약자, 응답 플래그
ISN: Initial Sequence Numbers 의 약어, 초기 네트워크 연결을 할 때 할당된 32비트 고유 시쿼스 번호

### TCP 연결 해제 과정
4-웨이 핸드쉐이크
![](https://velog.velcdn.com/images/noahshin__11/post/ec9b5137-f508-4f3a-b54e-96093dabe68f/image.png)

이 과정중에 중요한건 **TIME_WAIT** 
그냥 연결을 닫으면 되지 왜 굳이 일정시간 뒤에 닫을까?

1. 지연 패킷이 발생할 경우를 대비하기 위함.
패킷이 뒤늦게 도달하고 이를 처리하지 못한다면 데이터 무결성 문제가 발생
2. 두 장치가 연결이 닫혔는지 확인하기 위해서.
만약 LAST_ACK 상태에서 닫히게 되면 다시 새로운 연결을 하려고 할 때 장치는 줄곧 LAST_ACK 로 되어 있기 때문에 접속 오류가 나타남.
이래서 TIME_WAIT 필요

![](https://velog.velcdn.com/images/noahshin__11/post/7bf77e95-0966-421a-bfc0-00122c1bd895/image.png)

## 인터넷 계층
- 장치로부터 받은 네트워크 패킷을 IP주소로 지정된 목적지로 전송하기 위해 사용되는 계층. 
IP, ARP, ICMP 등이 있으며 패킷을 수신해야 할 상대의 주소를 지정하여 데이터를 전달.
상대방이 제대로 받았는지에 대해 보장하지 않는 비연결형적인 특징.

## 링크 계층
- 전선, 광섬유, 무선 등으로 실질적으로 데이터를 전달하며 장치간에 신호를 주고받는 "규칙"을 정하는 계층.
- 네트워크 접근 계층이라고도 한다.

- 이를 물리 계층과 데이터 링크 계층으로 나누기도 하는데
물리 계층은 무선 LAN 과 유선 LAN 을 통해 0 & 1 로 이루어진 데이터를 보내는 계층을 말한다.
- 데이터 링크 계층은 '이더넷 프레임'을 통해 에러확인, 흐름제어, 접근제어를 담당하는 계층

### 유선 LAN (IEEE802.3)
### _전이중화 통신_
- (full duplex) 통신은 양쪽 장치가 동시에 송수신할 수 있는 방식
송신로와 수신로로 나눠서 데이터를 주고받고 
- 현대의 고속 이더넷은 이 방식을 기반으로 통신
![](https://velog.velcdn.com/images/noahshin__11/post/c2583090-264a-43c3-b0e6-513604600189/image.png)

### 유선 LAN 을 이루는 케이블
TP 케이블이라고 하는 트위스트 페어 케이블과 광섬유 케이블이 대표적

> 트위스트 페어 케이블: 하나의 케이블처럼 보이지만 실제로는 8개의 구리선을 두개씩 꼬아서 묶은 케이블
![](https://velog.velcdn.com/images/noahshin__11/post/44123ce3-d914-4f0d-8ad4-cf9ffec46d5d/image.png)
8개의 구리선

케이블은 구리선을 실드 처리하지 않고 덮은 UTP 케이블과 실드 처리하고 덮은 STP로 나눠진다.
우리가 흔히 볼 수 있는 케이블은 UTP 케이블로 흔히 LAN 케이블이라고 한다.

![](https://velog.velcdn.com/images/noahshin__11/post/a63c5e3c-d726-4ac2-b79a-7c550f5fd075/image.png)

### 광섬유 케이블
- 레이저를 이용해서 통신하기 때문에 구리선과는 비교할 수 없을 만큼 장거리 및 고속 통신 가능,
- 보통 100Gbps 의 데이터를 전송하며 다음 그림처럼 광섬유 내부와 외부를 다른 밀도를 가지는 유리나 프랄스틱 섬유로 제작해서 한 번 들어간 빛이 내부에서 계속적으로 반사하며 전진하여 반대편 끝까지 가는 원리를 이용한 것
![](https://velog.velcdn.com/images/noahshin__11/post/a58a6a9b-be3b-4d28-b1cf-0a7462bb234d/image.png)

### 무선 LAN (IEEE802.11) 반이중화 통신
- half duplex 는 양쪽 장치는 서로 통신할 수 있지만, 동시에는 통신할 수 없으며 한번에 한 방향만 통신할 수 있는 방식
![](https://velog.velcdn.com/images/noahshin__11/post/5c16ddfe-c601-4eeb-aa93-352d1fec186a/image.png)















